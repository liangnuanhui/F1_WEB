# F1 数据建模计划 - 基于 FastF1 实际数据结构

## 目标

基于 FastF1 实际数据结构分析结果，重新设计数据模型并实现数据同步。

## 关键发现

通过 `data_explorer.py` 的分析，我们发现：

1. **FastF1 数据结构与我们的模型不匹配** - 实际字段名和数据类型与我们的模型定义不同
2. **ErgastMultiResponse 复杂结构** - 比赛结果数据包含嵌套的车手和车队信息
3. **数据完整性高** - 所有字段都有 100%的完整度
4. **自然键存在** - 每个实体都有唯一的业务标识符

## FastF1 实际数据结构

### 1. 赛道数据 (Circuits)

- `circuitId`: 主键，唯一标识
- `circuitName`: 赛道名称
- `locality`: 城市
- `country`: 国家
- `lat`, `long`: 坐标

### 2. 车队数据 (Constructors)

- `constructorId`: 主键，唯一标识
- `constructorName`: 车队名称
- `constructorNationality`: 国籍

### 3. 车手数据 (Drivers)

- `driverId`: 主键，唯一标识
- `driverNumber`: 车手号码
- `driverCode`: 车手代码
- `givenName`, `familyName`: 姓名
- `dateOfBirth`: 出生日期
- `driverNationality`: 国籍

### 4. 比赛结果数据 (Results)

- 包含完整的车手和车队信息
- 时间、位置、积分等详细数据
- 最快圈信息

## 重新设计策略

### 1. 字段名完全匹配

使用 FastF1 的实际字段名，避免映射错误

### 2. 数据类型匹配

使用 FastF1 的实际数据类型

### 3. 关联关系清晰

通过外键建立明确的关联关系

### 4. 数据范围控制

只同步 2023-2025 赛季数据

## 实施步骤

### Phase 1: 清理现有数据

- [ ] 清空数据库
- [ ] 删除现有模型文件
- [ ] 删除相关同步代码

### Phase 2: 创建新模型

- [ ] 基于 FastF1 实际数据结构创建模型
- [ ] 生成数据库迁移
- [ ] 应用迁移

### Phase 3: 实现数据同步

- [ ] 赛季数据同步 (2023-2025)
- [ ] 赛道数据同步
- [ ] 车队数据同步
- [ ] 车手数据同步
- [ ] 比赛数据同步
- [ ] 结果数据同步

### Phase 4: 测试验证

- [ ] 数据完整性验证
- [ ] 关联关系验证
- [ ] 业务规则验证

## 预期成果

1. **准确的数据模型** - 完全匹配 FastF1 数据结构
2. **可靠的同步逻辑** - 处理 ErgastMultiResponse 复杂结构
3. **完整的测试覆盖** - 确保数据质量
4. **高效的数据范围** - 只同步相关赛季数据

## 风险评估

1. **数据源变化** - FastF1 API 可能更新
2. **关联复杂性** - 多表关联可能复杂
3. **性能问题** - 大量数据同步可能慢

## 缓解措施

1. **版本控制** - 记录数据源版本
2. **渐进式开发** - 一次处理一个表
3. **性能优化** - 批量操作和索引
4. **数据范围控制** - 只同步目标赛季数据

## 数据范围控制策略

### 1. 赛季过滤

```python
# 定义目标赛季
TARGET_SEASONS = [2023, 2024, 2025]

# 过滤赛季数据
target_seasons = all_seasons[all_seasons['season'].isin(TARGET_SEASONS)]
```

### 2. 性能优化

- 避免获取不必要的历史数据
- 减少网络请求和数据处理时间
- 降低存储空间需求
- 提高同步效率

### 3. 业务价值

- 专注于当前相关赛季
- 提供更有价值的分析数据
- 减少数据噪音
- 提高用户体验
