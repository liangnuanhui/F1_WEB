âº F1 æ¯”èµ›åæ•°æ®åŒæ­¥å®Œæ•´ä½¿ç”¨æŒ‡å—

ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—å°†è¯¦ç»†è¯´æ˜å¦‚ä½•ä½¿ç”¨ä¸¤ä¸ªæ–°åˆ›å»ºçš„åŒæ•°æ®åº“åŒæ­¥è„šæœ¬æ¥æ›´æ–° F1 æ¯”èµ›æ•°æ®ã€‚è¿™ä¸¤ä¸ªè„šæœ¬å¯ä»¥åŒæ—¶å°†æœ€æ–°çš„æ¯”èµ›æ•°æ®åŒæ­¥åˆ°
æœ¬åœ°æ•°æ®åº“å’Œ Render äº‘æ•°æ®åº“ã€‚

ğŸ¯ è„šæœ¬ä»‹ç»

1. dual_database_sync.py (ç®€å•ç‰ˆ - æ¨èæ—¥å¸¸ä½¿ç”¨)

- ç‰¹ç‚¹: ä¸€é”®åŒæ­¥æ‰€æœ‰æ•°æ®åˆ°ä¸¤ä¸ªæ•°æ®åº“
- ä¼˜ç‚¹: æ“ä½œç®€å•ï¼Œæ— éœ€å‚æ•°
- é€‚ç”¨: æ¯”èµ›åçš„å¸¸è§„æ•°æ®æ›´æ–°

2. smart_sync.py (æ™ºèƒ½ç‰ˆ - é«˜çº§ç”¨æˆ·)

- ç‰¹ç‚¹: æ”¯æŒçµæ´»é…ç½®å’Œé€‰æ‹©æ€§åŒæ­¥
- ä¼˜ç‚¹: å¯è‡ªå®šä¹‰åŒæ­¥é€‰é¡¹
- é€‚ç”¨: éœ€è¦ç²¾ç¡®æ§åˆ¶åŒæ­¥å†…å®¹æ—¶

ğŸ› ï¸ ç¯å¢ƒå‡†å¤‡

å‰ç½®æ¡ä»¶æ£€æŸ¥

åœ¨ä½¿ç”¨è„šæœ¬å‰ï¼Œè¯·ç¡®ä¿æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š

# 1. æ£€æŸ¥ Docker æ˜¯å¦è¿è¡Œï¼ˆæœ¬åœ°æ•°æ®åº“éœ€è¦ï¼‰

docker ps | grep f1_postgres

# å¦‚æœæ²¡æœ‰è¿è¡Œï¼Œå¯åŠ¨ Docker å®¹å™¨

cd /Users/liangnuanhui/Documents/F1-web
docker-compose up -d

# 2. æ£€æŸ¥ Poetry ç¯å¢ƒ

cd /Users/liangnuanhui/Documents/F1-web/backend
poetry --version

# 3. éªŒè¯è„šæœ¬å­˜åœ¨

ls -la scripts/dual_database_sync.py scripts/smart_sync.py

ğŸš€ ä½¿ç”¨æ–¹æ³•è¯¦è§£

æ–¹æ³•ä¸€ï¼šç®€å•ç‰ˆè„šæœ¬ (dual_database_sync.py)

åŸºæœ¬ä½¿ç”¨

cd /Users/liangnuanhui/Documents/F1-web/backend

# ä¸€é”®åŒæ­¥æ‰€æœ‰æ•°æ®åˆ°æœ¬åœ°å’Œ Render æ•°æ®åº“

poetry run python scripts/dual_database_sync.py

æ‰§è¡Œè¿‡ç¨‹è¯´æ˜

è„šæœ¬ä¼šä¾æ¬¡æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š

1. è¿æ¥æœ¬åœ°æ•°æ®åº“ï¼ŒåŒæ­¥ä»¥ä¸‹æ•°æ®ï¼š

   - âœ… è½¦æ‰‹ç§¯åˆ†æ¦œ (Driver Standings)
   - âœ… è½¦é˜Ÿç§¯åˆ†æ¦œ (Constructor Standings)
   - âœ… æ¯”èµ›ç»“æœ (Race Results)
   - âœ… æ’ä½èµ›ç»“æœ (Qualifying Results)
   - âœ… å†²åˆºèµ›ç»“æœ (Sprint Results)

2. è¿æ¥ Render æ•°æ®åº“ï¼ŒåŒæ­¥ç›¸åŒçš„æ•°æ®
3. è¾“å‡ºåŒæ­¥ç»“æœæ€»ç»“

é¢„æœŸè¾“å‡ºç¤ºä¾‹

2025-07-28 14:30:00,123 - INFO - ğŸš€ å¼€å§‹åŒæ­¥æ•°æ®åˆ° æœ¬åœ° æ•°æ®åº“...
2025-07-28 14:30:05,456 - INFO - âœ… æœ¬åœ°: è½¦æ‰‹ç§¯åˆ†æ¦œåŒæ­¥æˆåŠŸ
2025-07-28 14:30:10,789 - INFO - âœ… æœ¬åœ°: è½¦é˜Ÿç§¯åˆ†æ¦œåŒæ­¥æˆåŠŸ
...
2025-07-28 14:35:00,123 - INFO - ğŸš€ å¼€å§‹åŒæ­¥æ•°æ®åˆ° Render æ•°æ®åº“...
...
==================================================
ğŸ“Š åŒæ•°æ®åº“åŒæ­¥ç»“æœæ€»ç»“:
æœ¬åœ°æ•°æ®åº“: âœ… æˆåŠŸ
Render æ•°æ®åº“: âœ… æˆåŠŸ
ğŸ‰ åŒæ•°æ®åº“åŒæ­¥å…¨éƒ¨æˆåŠŸï¼

æ–¹æ³•äºŒï¼šæ™ºèƒ½ç‰ˆè„šæœ¬ (smart_sync.py)

æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯

poetry run python scripts/smart_sync.py --help

å¸¸ç”¨å‘½ä»¤ç¤ºä¾‹

1. æ ‡å‡†ä½¿ç”¨ï¼ˆç­‰åŒäºç®€å•ç‰ˆï¼‰

# åŒæ­¥æ‰€æœ‰æ•°æ®åˆ°ä¸¤ä¸ªæ•°æ®åº“

poetry run python scripts/smart_sync.py

2. é€‰æ‹©æ€§æ•°æ®åŒæ­¥

# åªåŒæ­¥ç§¯åˆ†æ¦œæ•°æ®

poetry run python scripts/smart_sync.py --data-types drivers constructors

# åªåŒæ­¥æ¯”èµ›ç›¸å…³ç»“æœ

poetry run python scripts/smart_sync.py -t race qualifying sprint

# åªåŒæ­¥è½¦æ‰‹ç§¯åˆ†æ¦œ

poetry run python scripts/smart_sync.py -t drivers

3. é€‰æ‹©æ€§æ•°æ®åº“åŒæ­¥

# åªåŒæ­¥åˆ°æœ¬åœ°æ•°æ®åº“

poetry run python scripts/smart_sync.py --databases local

# åªåŒæ­¥åˆ° Render æ•°æ®åº“

poetry run python scripts/smart_sync.py -d render

# åŒæ­¥åˆ°ä¸¤ä¸ªæ•°æ®åº“ï¼ˆé»˜è®¤ï¼‰

poetry run python scripts/smart_sync.py -d both

4. ä¸åŒèµ›å­£æ•°æ®åŒæ­¥

# åŒæ­¥ 2024 èµ›å­£æ•°æ®

poetry run python scripts/smart_sync.py --season 2024

# åŒæ­¥ 2023 èµ›å­£æ•°æ®

poetry run python scripts/smart_sync.py -s 2023

5. ç»„åˆä½¿ç”¨

# åªåŒæ­¥ 2025 èµ›å­£çš„è½¦æ‰‹å’Œè½¦é˜Ÿç§¯åˆ†æ¦œåˆ°æœ¬åœ°æ•°æ®åº“ï¼Œæ˜¾ç¤ºè¯¦ç»†æ—¥å¿—

poetry run python scripts/smart_sync.py -d local -s 2025 -t drivers constructors -v

ğŸ“… æ ‡å‡†ä½¿ç”¨æµç¨‹

æ¯æ¬¡æ¯”èµ›åçš„æ ‡å‡†æ“ä½œæµç¨‹

æ­¥éª¤ 1ï¼šç¡®ä¿ç¯å¢ƒå‡†å¤‡å°±ç»ª

cd /Users/liangnuanhui/Documents/F1-web/backend

# å¯åŠ¨æœ¬åœ° Docker æ•°æ®åº“

docker-compose up -d

# ç­‰å¾…æ•°æ®åº“å¯åŠ¨å®Œæˆï¼ˆçº¦ 10-15 ç§’ï¼‰

sleep 15

æ­¥éª¤ 2ï¼šæ‰§è¡Œæ•°æ®åŒæ­¥

# æ¨èä½¿ç”¨ç®€å•ç‰ˆï¼ˆä¸€æ¡å‘½ä»¤æå®šï¼‰

poetry run python scripts/dual_database_sync.py

æ­¥éª¤ 3ï¼šéªŒè¯åŒæ­¥ç»“æœ

# æ£€æŸ¥æœ¬åœ° API æ˜¯å¦æœ‰æœ€æ–°æ•°æ®ï¼ˆå¦‚æœæœ¬åœ° API åœ¨è¿è¡Œï¼‰

curl -s "http://localhost:8000/api/v1/standings/drivers?season_year=2025" | head -10

# æ£€æŸ¥ Render API æ˜¯å¦æœ‰æœ€æ–°æ•°æ®

curl -s "https://f1-web-api.onrender.com/api/v1/standings/drivers?season_year=2025" | head -10

ğŸš¨ æ•…éšœæ’é™¤

å¸¸è§é—®é¢˜åŠè§£å†³æ–¹æ¡ˆ

1. Docker æ•°æ®åº“è¿æ¥å¤±è´¥

é”™è¯¯ä¿¡æ¯: connection to server at "localhost", port 5432 failed

è§£å†³æ–¹æ¡ˆ:

# æ£€æŸ¥ Docker å®¹å™¨çŠ¶æ€

docker ps | grep postgres

# é‡å¯ Docker å®¹å™¨

docker-compose down
docker-compose up -d

# ç­‰å¾…æ•°æ®åº“å®Œå…¨å¯åŠ¨

sleep 20

2. Render æ•°æ®åº“è¿æ¥è¶…æ—¶

é”™è¯¯ä¿¡æ¯: timeout expired æˆ– connection timed out

è§£å†³æ–¹æ¡ˆ:

# åªåŒæ­¥åˆ°æœ¬åœ°æ•°æ®åº“ï¼Œç¨åå•ç‹¬åŒæ­¥ Render

poetry run python scripts/smart_sync.py -d local

# ç¨åé‡è¯• Render æ•°æ®åº“

poetry run python scripts/smart_sync.py -d render

3. éƒ¨åˆ†æ•°æ®åŒæ­¥å¤±è´¥

é”™è¯¯ä¿¡æ¯: âŒ XXX æ•°æ®åº“: XXX åŒæ­¥å¤±è´¥

è§£å†³æ–¹æ¡ˆ:

# ä½¿ç”¨æ™ºèƒ½ç‰ˆåªåŒæ­¥å¤±è´¥çš„æ•°æ®ç±»å‹

# ä¾‹å¦‚ï¼šå¦‚æœå†²åˆºèµ›ç»“æœåŒæ­¥å¤±è´¥

poetry run python scripts/smart_sync.py -t sprint -v

# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

poetry run python scripts/smart_sync.py --verbose

4. æƒé™é—®é¢˜

é”™è¯¯ä¿¡æ¯: permission denied æˆ– authentication failed

è§£å†³æ–¹æ¡ˆ:

# æ£€æŸ¥è„šæœ¬æƒé™

chmod +x scripts/dual_database_sync.py scripts/smart_sync.py

# æ£€æŸ¥æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²æ˜¯å¦æ­£ç¡®

# ç¡®ä¿ Render æ•°æ®åº“ URL æ²¡æœ‰è¿‡æœŸ

ğŸ“Š æœ€ä½³å®è·µå»ºè®®

1. å®šæœŸä½¿ç”¨æµç¨‹

# æ¯ä¸ªæ¯”èµ›å‘¨æœ«åçš„æ ‡å‡†æµç¨‹

cd /Users/liangnuanhui/Documents/F1-web/backend
docker-compose up -d
sleep 15
poetry run python scripts/dual_database_sync.py

2. èµ›å­£å¼€å§‹å‰çš„æµ‹è¯•

# æµ‹è¯•è„šæœ¬æ˜¯å¦æ­£å¸¸å·¥ä½œ

poetry run python scripts/smart_sync.py -t drivers -v

3. ç´§æ€¥æƒ…å†µå¤„ç†

# å¦‚æœæŸä¸ªæ•°æ®åº“è¿æ¥æœ‰é—®é¢˜ï¼Œåˆ†åˆ«åŒæ­¥

poetry run python scripts/smart_sync.py -d local
poetry run python scripts/smart_sync.py -d render

4. æ•°æ®éªŒè¯

# åŒæ­¥åéªŒè¯æ•°æ®æ˜¯å¦æ­£ç¡®æ›´æ–°

curl -s "https://f1-web-api.onrender.com/api/v1/standings/drivers?season_year=2025" | python3 -c "
import json, sys
data = json.load(sys.stdin)
if data.get('success'):
print(f'å‰ 3 å: {[d[\"driver_name\"] + \" \" + str(d[\"points\"]) + \"åˆ†\" for d in data[\"data\"][:3]]}')
"

ğŸ¯ è„šæœ¬é€‰æ‹©æŒ‡å—

ä»€ä¹ˆæ—¶å€™ä½¿ç”¨ç®€å•ç‰ˆ (dual_database_sync.py)

- âœ… æ¯”èµ›åˆšç»“æŸï¼Œéœ€è¦æ›´æ–°æ‰€æœ‰æ•°æ®
- âœ… æ—¥å¸¸ç»´æŠ¤ï¼Œä¿æŒæ•°æ®åŒæ­¥
- âœ… ä¸éœ€è¦ç‰¹æ®Šé…ç½®çš„æƒ…å†µ
- âœ… å¿«é€Ÿæ“ä½œï¼Œä¸€æ¡å‘½ä»¤æå®š

ä»€ä¹ˆæ—¶å€™ä½¿ç”¨æ™ºèƒ½ç‰ˆ (smart_sync.py)

- âœ… åªéœ€è¦æ›´æ–°æŸäº›ç‰¹å®šæ•°æ®ï¼ˆå¦‚åªè¦ç§¯åˆ†æ¦œï¼‰
- âœ… æŸä¸ªæ•°æ®åº“æœ‰é—®é¢˜ï¼Œéœ€è¦å•ç‹¬åŒæ­¥
- âœ… éœ€è¦åŒæ­¥å†å²èµ›å­£æ•°æ®
- âœ… éœ€è¦è¯¦ç»†æ—¥å¿—è¿›è¡Œé—®é¢˜æ’æŸ¥
- âœ… åœ¨ä¸åŒç¯å¢ƒä¸‹æµ‹è¯•

ğŸ“ åˆ›å»ºå¿«æ·å‘½ä»¤ï¼ˆå¯é€‰ï¼‰

ä¸ºäº†æ›´æ–¹ä¾¿ä½¿ç”¨ï¼Œä½ å¯ä»¥åˆ›å»ºåˆ«åï¼š

# åœ¨ ~/.zshrc æˆ– ~/.bashrc ä¸­æ·»åŠ 

alias f1sync="cd /Users/liangnuanhui/Documents/F1-web/backend && docker-compose up -d && sleep 15 && poetry
run python scripts/dual_database_sync.py"
alias f1smart="cd /Users/liangnuanhui/Documents/F1-web/backend && poetry run python scripts/smart_sync.py"

# é‡æ–°åŠ è½½é…ç½®

source ~/.zshrc # æˆ– source ~/.bashrc

è¿™æ ·ä½ å°±å¯ä»¥ç®€å•åœ°ä½¿ç”¨ï¼š

# ä¸€æ¡å‘½ä»¤å®Œæˆæ‰€æœ‰æ“ä½œ

f1sync

# ä½¿ç”¨æ™ºèƒ½ç‰ˆ

f1smart -t drivers constructors

ğŸ‰ æ€»ç»“

- æ—¥å¸¸ä½¿ç”¨: poetry run python scripts/dual_database_sync.py
- çµæ´»é…ç½®: poetry run python scripts/smart_sync.py [é€‰é¡¹]
- è®°ä½: å…ˆå¯åŠ¨ Dockerï¼Œå†æ‰§è¡ŒåŒæ­¥
- éªŒè¯: åŒæ­¥åæ£€æŸ¥ API è¿”å›çš„æ•°æ®æ˜¯å¦æœ€æ–°

è¿™ä¸¤ä¸ªè„šæœ¬ä¸ºä½ æä¾›äº†å®Œæ•´çš„ F1 æ•°æ®åŒæ­¥è§£å†³æ–¹æ¡ˆï¼Œæ—¢æœ‰ç®€å•æ˜“ç”¨çš„æ ‡å‡†ç‰ˆæœ¬ï¼Œä¹Ÿæœ‰çµæ´»å¼ºå¤§çš„æ™ºèƒ½ç‰ˆæœ¬ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯çš„éœ€
æ±‚ï¼
